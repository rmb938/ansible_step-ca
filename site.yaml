- name: Bootstrap
  hosts: all
  become: true
  remote_user: ubuntu
  roles:
    - rmb938.bootstrap

- name: Step CA
  hosts: all
  become: true
  remote_user: ubuntu
  roles:
    - step-ca
  vars:
    ras:
      acme:
        port: 8443
        policy:
          x509:
            allow:
              dns:
                - "*.rmb938.me"
                - "*.us-homelab1.hl.rmb938.me"
                - "*.tailnet-047c.ts.net"
        provisioner:
          type: ACME
          name: acme
          forceCN: true
          challenges:
            - http-01
      haproxy:
        port: 9443
        policy:
          x509:
            allow:
              dns:
                - "*.haproxy.us-homelab1.hl.rmb938.me"
        provisioner: {}
          # type: x5c
          # name: x5c
          # roots:
          #   - "a base64 encoded list of root certificate PEM blocks used for validating X5C tokens"
