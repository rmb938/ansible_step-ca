- name: Bootstrap
  hosts: all
  become: true
  remote_user: ubuntu
  roles:
    - rmb938.bootstrap

- name: Step CA
  hosts: all
  become: true
  remote_user: ubuntu
  roles:
    - step-ca
  vars:
    ras:
      acme:
        port: 8443
        policy:
          x509:
            allow:
              dns:
                - "*.rmb938.me"
                - "*.us-homelab1.hl.rmb938.me"
                - "*.tailnet-047c.ts.net"
        provisioner:
          type: ACME
          name: acme
          forceCN: true
          challenges:
            - http-01
      haproxy:
        port: 9443
        policy:
          x509:
            allow:
              dns:
                - "*.haproxy.us-homelab1.hl.rmb938.me"
        provisioner:
          type: x5c
          name: x5c
          roots:
            - "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUI3RENDQVhLZ0F3SUJBZ0lVQ1R3ZTNmT0g3R3RKclUzWHZaOGVFTHV5Y3RZd0NnWUlLb1pJemowRUF3TXcKSURFZU1Cd0dBMVVFQXhNVlUzUmxjQ0JZTlVNZ1NFRlFjbTk0ZVNCU2IyOTBNQjRYRFRJMU1ESXdPREl6TkRNMApNVm9YRFRJNE1ESXdPVEUzTVRFME4xb3dLakVvTUNZR0ExVUVBeE1mVTNSbGNDQllOVU1nU0VGUWNtOTRlU0JKCmJuUmxjbTFsWkdsaGRHVWdNREIyTUJBR0J5cUdTTTQ5QWdFR0JTdUJCQUFpQTJJQUJPZTdWVjNHeU1BTE0zU3MKcXBEdXEwL0pIRU9XcU94VEpNZ2VKTXVtSHlmWkhPRFVBUkZwR1VuL1lIcW0xejAzRmlwTzNsRWZBTGNFTzhsVgpUbHplUGh2NXVLQ09SeWY0bzBoUVZ5UUhDb0N6d1BqT3VvMlpmS0lqdWhralUzaTRlNk5qTUdFd0RnWURWUjBQCkFRSC9CQVFEQWdFR01BOEdBMVVkRXdFQi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZEOTRkaFRJYmdTSjg4SVQKL0kyd3FNZWlJWUJZTUI4R0ExVWRJd1FZTUJhQUZOY1BaMHlTVXVTclJaM0VUc2JnOWNQWWhpRzRNQW9HQ0NxRwpTTTQ5QkFNREEyZ0FNR1VDTVFEWXc2NzQzTU1VRkMwREtTaGJ4bnJpZmxMUjEzNG5mL3MxZWsxZWNGMGNEM3ZwClBzT2ZqM2NDZEdqMDRQOFc0TG9DTURUSFhPVE9DZk9mZTZ6TUlKYVhzZHB0RmRJZUREV3JtRVUwVUJNbWtVb3AKdnJxODRqY1NBVDcyMUQ4L2tyTm1PUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0="
