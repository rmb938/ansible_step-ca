- name: Bootstrap
  hosts: all
  become: true
  remote_user: ubuntu
  roles:
    - rmb938.bootstrap

- name: Step CA
  hosts: all
  become: true
  remote_user: ubuntu
  roles:
    - step-ca
  vars:
    ras:
      acme:
        port: 8443
        policy:
          x509:
            allow:
              dns:
                - "*.rmb938.me"
                - "*.us-homelab1.hl.rmb938.me"
                - "*.tailnet-047c.ts.net"
        provisioner:
          type: ACME
          name: acme
          forceCN: true
          challenges:
            - http-01
      haproxy:
        port: 9443
        policy:
          x509:
            allow:
              dns:
                - "*.haproxy.us-homelab1.hl.rmb938.me"
            allowWildcardNames: true
        provisioner:
          type: x5c
          name: x5c
          roots: >-
            LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUI0ekNDQVdpZ0F3SUJBZ0lVUnVJN1RPczlaYjlSZ2lZS2hpd0VMSFFDWEJzd0NnWUlLb1pJemowRUF3TXcKSURFZU1Cd0dBMVVFQXhNVlUzUmxjQ0JZTlVNZ1NFRlFjbTk0ZVNCU2IyOTBNQjRYRFRJMU1ETXhNVEF3TWpnegpNVm9YRFRRMU1ETXhNREl3TlRNd01Wb3dJREVlTUJ3R0ExVUVBeE1WVTNSbGNDQllOVU1nU0VGUWNtOTRlU0JTCmIyOTBNSFl3RUFZSEtvWkl6ajBDQVFZRks0RUVBQ0lEWWdBRUdnamM4RlpJdVZYeGdzMkNNNHRlR3V0cFJjSlYKQXAvN2dqZlkvR1draXB4UHZOSW5hRSt6K2kvSWtiVlhHZWdneWt1R3Q4cW80NG55OEpLMW9Xb0xHUDNkSzN0awoybkRnZk02bmZpTjE4S2hmUERjVzRvWmZQNCtOL1B2L0hNTWtvMk13WVRBT0JnTlZIUThCQWY4RUJBTUNBUVl3CkR3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVWJSalhKMlRLUVV5ZkVCWmt4T21qRlhtakhMUXcKSHdZRFZSMGpCQmd3Rm9BVWJSalhKMlRLUVV5ZkVCWmt4T21qRlhtakhMUXdDZ1lJS29aSXpqMEVBd01EYVFBdwpaZ0l4QVBGczl0NGRtZDF0bm5OMHNwQXNjTGhMZ3p2M1hnUGlIV0pFRStuaXdYK1NsV21CbTJDWnMrRzMxeXFvCkFhTVg2d0l4QUtGUXgxSEdpdkQwTllWYVh4Y3JpTStxRzlCcmc0QnpidE9FejFXWU1aRjdKTGtxRnhwSTJqS3QKWVQ2cWd0VUlXZz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0=
