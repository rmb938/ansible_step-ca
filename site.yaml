- name: Bootstrap
  hosts: all
  become: true
  remote_user: ubuntu
  roles:
    - rmb938.bootstrap

- name: Step CA
  hosts: all
  become: true
  remote_user: ubuntu
  roles:
    - step-ca
  vars:
    ras:
      acme:
        port: 8443
        policy:
          x509:
            allow:
              dns:
                - "*.rmb938.me"
                - "*.us-homelab1.hl.rmb938.me"
                - "*.tailnet-047c.ts.net"
        provisioner:
          type: ACME
          name: acme
          forceCN: true
          challenges:
            - http-01
      haproxy:
        port: 9443
        policy:
          x509:
            allow:
              dns:
                - "*.haproxy.us-homelab1.hl.rmb938.me"
            allowWildcardNames: true
        provisioner:
          type: x5c
          name: x5c
          roots: >-
            LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUI0VENDQVdpZ0F3SUJBZ0lVSEpSM2RLUndqeml2b09yUzBKOGk3OGVseFJZd0NnWUlLb1pJemowRUF3TXcKSURFZU1Cd0dBMVVFQXhNVlUzUmxjQ0JZTlVNZ1NFRlFjbTk0ZVNCU2IyOTBNQjRYRFRJMU1ESXdPVEl3TkRVMApOVm9YRFRRMU1ESXdPVEUzTVRBeE5Wb3dJREVlTUJ3R0ExVUVBeE1WVTNSbGNDQllOVU1nU0VGUWNtOTRlU0JTCmIyOTBNSFl3RUFZSEtvWkl6ajBDQVFZRks0RUVBQ0lEWWdBRVlrNmhQQVpqaDc1azYrNWVjczBrMEdFUTZSMCsKVkV2YzRCWXdvcThiZXk1NmQ1MkpNaXJqUmdtRDN1WGcxU3BBTjV0UHpZTUozVm5yRU9QMHM4U0kxWHFtRzBtbApuSzQ5Q0NGNUtKVmZPamQwVUZvUkJCajJqeGxudmJkeVhsYm1vMk13WVRBT0JnTlZIUThCQWY4RUJBTUNBUVl3CkR3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVStwM285alZlV3gySU5hY2xuL2NYSy95MnFIY3cKSHdZRFZSMGpCQmd3Rm9BVStwM285alZlV3gySU5hY2xuL2NYSy95MnFIY3dDZ1lJS29aSXpqMEVBd01EWndBdwpaQUl3YTE0bURlQ0twcGN5NVowdEtIajFnQXFjZXh1aUh2Y2R5WjRVWmVGdTFkWlZhd0RoMUFOeUIwUUxhSnJSCnZVek9BakFKRzVpYnlDcTRlbHdMMXRTNkRDakxMTEZYNmJwTXA0YmFjOFhxWFNqQ2dGandyd21SSjMxb0lmbC8Kd0d3bTdiWT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQ==
