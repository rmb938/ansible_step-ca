- name: Bootstrap
  hosts: all
  become: true
  remote_user: ubuntu
  roles:
    - rmb938.bootstrap

- name: Step CA
  hosts: all
  become: true
  remote_user: ubuntu
  roles:
    - step-ca
  vars:
    ras:
      acme:
        port: 8443
        policy:
          x509:
            allow:
              dns:
                - "*.rmb938.me"
                - "*.us-homelab1.hl.rmb938.me"
                - "*.tailnet-047c.ts.net"
        provisioner:
          type: ACME
          name: acme
          forceCN: true
          challenges:
            - http-01
      haproxy:
        port: 9443
        policy:
          x509:
            allow:
              dns:
                - "*.haproxy.us-homelab1.hl.rmb938.me"
            allowWildcardNames: true
        provisioner:
          type: x5c
          name: x5c
          roots: >-
            LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUI3RENDQVhLZ0F3SUJBZ0lVUllhNUJ2V3NmSXViSUxYWmFEWmJxRTc5b0U4d0NnWUlLb1pJemowRUF3TXcKSURFZU1Cd0dBMVVFQXhNVlUzUmxjQ0JZTlVNZ1NFRlFjbTk0ZVNCU2IyOTBNQjRYRFRJMU1ETXhNVEF3TWpnegpNMW9YRFRJNE1ETXhNREUzTlRZek9Wb3dLakVvTUNZR0ExVUVBeE1mVTNSbGNDQllOVU1nU0VGUWNtOTRlU0JKCmJuUmxjbTFsWkdsaGRHVWdNREIyTUJBR0J5cUdTTTQ5QWdFR0JTdUJCQUFpQTJJQUJNdkE1YjJkcUFuVmswZloKeHpNNnhOd2czOWJidGJ6bE9VUGFnQ2RVaGI2cGFOelF4bFZjTmhWcjlDT1pFNGd4c3gvTVA5WHVqRWtUNVNHQQo3YndUSXhxWmVZTWdYQUV0ZU81c3F6Z283ckNmNVVENGZpTEJCNnprYjNXYWlaVG9XYU5qTUdFd0RnWURWUjBQCkFRSC9CQVFEQWdFR01BOEdBMVVkRXdFQi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZPRlVSd2tHWXJqUW9JYkwKUUIvTitiMTNqZGcyTUI4R0ExVWRJd1FZTUJhQUZHMFkxeWRreWtGTW54QVdaTVRwb3hWNW94eTBNQW9HQ0NxRwpTTTQ5QkFNREEyZ0FNR1VDTVFEdkNiT1Q3dGRXOFVIdUtxc0xPMnlCQ2h1SXFYc0VySXZoVFFpek02ZVpnZHp0Ci9TcTVlZWhNenBnZVRDeFBTUGdDTUVkUi9LK0hOMHR6SUxJNVRFU1JXMWRiWmJ4TDRmanRyZDFBZ0kxR0lKZUQKNTNuUGpZZE1hNWNMbGYzMnpkZ2VqZz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KCi0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlCNHpDQ0FXaWdBd0lCQWdJVVJ1STdUT3M5WmI5UmdpWUtoaXdFTEhRQ1hCc3dDZ1lJS29aSXpqMEVBd013CklERWVNQndHQTFVRUF4TVZVM1JsY0NCWU5VTWdTRUZRY205NGVTQlNiMjkwTUI0WERUSTFNRE14TVRBd01qZ3oKTVZvWERUUTFNRE14TURJd05UTXdNVm93SURFZU1Cd0dBMVVFQXhNVlUzUmxjQ0JZTlVNZ1NFRlFjbTk0ZVNCUwpiMjkwTUhZd0VBWUhLb1pJemowQ0FRWUZLNEVFQUNJRFlnQUVHZ2pjOEZaSXVWWHhnczJDTTR0ZUd1dHBSY0pWCkFwLzdnamZZL0dXa2lweFB2TkluYUUreitpL0lrYlZYR2VnZ3lrdUd0OHFvNDRueThKSzFvV29MR1AzZEszdGsKMm5EZ2ZNNm5maU4xOEtoZlBEY1c0b1pmUDQrTi9Qdi9ITU1rbzJNd1lUQU9CZ05WSFE4QkFmOEVCQU1DQVFZdwpEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVViUmpYSjJUS1FVeWZFQlpreE9takZYbWpITFF3Ckh3WURWUjBqQkJnd0ZvQVViUmpYSjJUS1FVeWZFQlpreE9takZYbWpITFF3Q2dZSUtvWkl6ajBFQXdNRGFRQXcKWmdJeEFQRnM5dDRkbWQxdG5uTjBzcEFzY0xoTGd6djNYZ1BpSFdKRUUrbml3WCtTbFdtQm0yQ1pzK0czMXlxbwpBYU1YNndJeEFLRlF4MUhHaXZEME5ZVmFYeGNyaU0rcUc5QnJnNEJ6YnRPRXoxV1lNWkY3SkxrcUZ4cEkyakt0CllUNnFndFVJV2c9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
